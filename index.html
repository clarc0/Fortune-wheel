<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Marlens Fortune Wheel</title>
<style>
  body {
    margin: 0;
    background: #0f0f0f;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  #wrapper {
    position: relative;
    width: 90vw;
    max-width: 480px;
    aspect-ratio: 1/1;
  }

  #wheelCanvas {
    width: 100%;
    height: 100%;
  }

  /* –°—Ç—Ä–µ–ª–∫–∞ */
  #pointer {
    position: absolute;
    top: -5%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-bottom: 35px solid #ffcf33;
    filter: drop-shadow(0 0 5px #000);
  }

  /* –ú–æ–¥–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
  #winnerModal {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.65);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 1.6rem;
    font-weight: bold;
    text-align: center;
    padding: 20px;
    border-radius: 20px;
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: 0.4s ease;
    pointer-events: none;
  }

  #winnerModal.show {
    opacity: 1;
    pointer-events: all;
  }
</style>
</head>
<body>

<div id="wrapper">
  <div id="pointer"></div>
  <canvas id="wheelCanvas"></canvas>
  <div id="winnerModal"></div>
</div>

<script>
const canvas = document.getElementById("wheelCanvas");
const ctx = canvas.getContext("2d");
let size = canvas.width = canvas.height = 800;

// –°–µ–≥–º–µ–Ω—Ç—ã –∫–æ–ª–µ—Å–∞
const slices = [
  "–ü—É—Å—Ç–æ",
  "5% —Å–∫–∏–¥–∫–∞",
  "–ü—É—Å—Ç–æ",
  "20% —Å–∫–∏–¥–∫–∞",
  "–ü—É—Å—Ç–æ",
  "5% —Å–∫–∏–¥–∫–∞"
];

// –¶–≤–µ—Ç–∞
const colors = ["#ff5555", "#55aaff", "#ffaa00", "#33cc66", "#aa55ff", "#ff8844"];

// –£–≥–æ–ª
let rotation = 0;
let spinning = false;

function drawWheel() {
  let arc = (2 * Math.PI) / slices.length;

  ctx.clearRect(0, 0, size, size);
  ctx.save();
  ctx.translate(size / 2, size / 2);
  ctx.rotate(rotation);

  for (let i = 0; i < slices.length; i++) {
    ctx.beginPath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.moveTo(0, 0);
    ctx.arc(0, 0, size / 2, arc * i, arc * (i + 1));
    ctx.fill();
    ctx.save();

    ctx.rotate(arc * (i + 0.5));
    ctx.fillStyle = "#fff";
    ctx.font = "bold 32px Arial";
    ctx.textAlign = "center";
    ctx.fillText(slices[i], size / 4, 10);

    ctx.restore();
  }

  ctx.restore();
}

drawWheel();

function spinWheel() {
  if (spinning) return;
  spinning = true;

  // –í—Å–µ–≥–¥–∞ –≤—ã–∏–≥—Ä—ã–≤–∞–µ–º "20% —Å–∫–∏–¥–∫–∞"
  let targetIndex = slices.indexOf("20% —Å–∫–∏–¥–∫–∞");
  let arc = (2 * Math.PI) / slices.length;

  // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —É–≥–ª–∞
  let targetAngle = (Math.PI / 2) - arc * (targetIndex + 0.5);

  // –î–æ–±–∞–≤–ª—è–µ–º 5+ –æ–±–æ—Ä–æ—Ç–æ–≤
  let finalRotation = targetAngle + Math.PI * 10;

  let start = rotation;
  let duration = 4000;
  let startTime = performance.now();

  function animate(now) {
    let progress = Math.min((now - startTime) / duration, 1);
    // easeOutCubic
    let eased = 1 - Math.pow(1 - progress, 3);

    rotation = start + (finalRotation - start) * eased;
    drawWheel();

    if (progress < 1) {
      requestAnimationFrame(animate);
    } else {
      showWinner("20% —Å–∫–∏–¥–∫–∞");
      spinning = false;
    }
  }

  requestAnimationFrame(animate);
}

// –ú–æ–¥–∞–ª–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
function showWinner(text) {
  const modal = document.getElementById("winnerModal");
  modal.innerHTML = "üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: <br><br>" + text + " üéâ";
  modal.classList.add("show");

  setTimeout(() => {
    modal.classList.remove("show");
  }, 5000);
}

// –ö–ª–∏–∫ –ø–æ –∫–æ–ª–µ—Å—É
canvas.addEventListener("click", spinWheel);
</script>
</body>
</html>
</script>

</body>
</html>
